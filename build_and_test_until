#!/bin/sh
# Load all files sorting before the given argument.
# You can pass in a prefix, but files matching the prefix *won't* be included.

set -e
set -v
make --no-print-directory tangle/tangle
make --no-print-directory enumerate/enumerate
./tangle/tangle $(./enumerate/enumerate --until $1 |grep -v '.mu$') |grep -v "^\s*//:" > mu.cc
cat /dev/null $(./enumerate/enumerate --until $1 |grep '.mu$') > core.mu
make --no-print-directory autogenerated_lists
CXX=${CXX:-clang++} CFLAGS=${CFLAGS:-"-O3 -fsanitize=undefined"} make ${2:-valgrind}
